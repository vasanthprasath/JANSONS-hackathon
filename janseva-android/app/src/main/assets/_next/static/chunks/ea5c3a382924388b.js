(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,10708,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(47163);let a=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("label",{ref:a,className:(0,s.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-slate-700",e),...r}));a.displayName="Label",e.s(["Label",()=>a])},23750,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(47163);let a=r.forwardRef(({className:e,type:r,...a},l)=>(0,t.jsx)("input",{type:r,className:(0,s.cn)("flex h-10 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-slate-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#2563eb] focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:l,...a}));a.displayName="Input",e.s(["Input",()=>a])},68553,e=>{"use strict";let t=(0,e.i(75254).default)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);e.s(["Camera",()=>t],68553)},71689,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},69259,e=>{"use strict";let t="janseva_complaints",r=(e,t,r)=>{let s=`${e} ${t} ${r}`.toLowerCase();return["accident","fire","gas leak","flood","fallen tree","electric shock","sewage overflow","road collapse","water pipeline burst","burst","collapse","danger","hazard","chemical spill","factory fire","industrial gas leak","explosion","safety risk","unsafe","gas leak"].some(e=>s.includes(e))?"Emergency":["street light","garbage","drainage","water leakage","pothole","traffic signal","leak","blocked","pollution","waste","fumes","banking","ticket","staff"].some(e=>s.includes(e))?"Moderate":"Casual"},s=e=>{let t=10;return e.image&&(t+=5),"Emergency"===e.priorityType&&(t+=10),"Moderate"===e.priorityType&&(t+=5),t},a=()=>{let e=localStorage.getItem(t);if(!e)return[];try{return JSON.parse(e)}catch(e){return console.error("Failed to parse complaints",e),[]}},l=async(r,s,l)=>{let{sendNotification:o}=await e.A(4021),n=a(),d=n.findIndex(e=>e.id===r);if(-1!==d){var c,m,u,h;let e,a,p,g=n[d];"Work Completed"===s&&l?.workerProofLocation&&(c=g.lat,m=g.lng,u=l.workerProofLocation.lat,h=l.workerProofLocation.lng,e=i(u-c),a=i(h-m),6371*(2*Math.atan2(Math.sqrt(p=Math.sin(e/2)*Math.sin(e/2)+Math.cos(i(c))*Math.cos(i(u))*Math.sin(a/2)*Math.sin(a/2)),Math.sqrt(1-p)))>.5)&&(l.workerRemarks=(l.workerRemarks||"")+" [FLAG: Location mismatch detected]");let x={...g,status:s,...l};n[d]=x;let f={status:s,date:new Date().toISOString(),completed:!0};n[d].timeline.push(f),localStorage.setItem(t,JSON.stringify(n)),"Resolved"===s?o("user",`Good news! Your complaint #${r} has been marked as RESOLVED.`,"success",r):"In Progress"===s?(o("user",`Work has started on your complaint #${r}.`,"info",r),x.workerId&&o("worker",`New task assigned: Complaint #${r}. Please check details.`,"info",r)):"Work Completed"===s?o("authority",`Work completed for #${r}. Waiting for verification.`,"success",r):"Delayed"===s&&o("admin",`SLA Breach: Complaint #${r} is currently DELAYED.`,"error",r)}};function i(e){return Math.PI/180*e}let o=async()=>{let r=a(),s=!1,l=new Date,{sendNotification:i}=await e.A(4021);r.forEach(e=>{e.workDeadline&&!["Work Completed","Resolved","Rejected"].includes(e.status)&&!e.isOverdue&&l>new Date(e.workDeadline)&&(e.isOverdue=!0,e.alertSentAt=l.toISOString(),("In Progress"===e.status||"Submitted"===e.status)&&(e.status="Delayed",e.timeline.push({status:"Delayed",date:l.toISOString(),completed:!0})),s=!0,e.workerId&&i("worker",`URGENT: Task #${e.id} is Overdue! Please complete immediately.`,"error",e.id),i("authority",`Alert: Task #${e.id} has breached deadline. Worker: ${e.workerId||"Unassigned"}`,"warning",e.id))}),s&&localStorage.setItem(t,JSON.stringify(r))};e.s(["calculateCreditPoints",0,s,"checkOverdueComplaints",0,o,"determinePriority",0,r,"getComplaintById",0,e=>a().find(t=>t.id===e),"getComplaints",0,a,"saveComplaint",0,e=>{e.priorityType||(e.priorityType=r(e.title,e.description,e.category)),e.creditPoints=s(e);let l=a();l.unshift(e),localStorage.setItem(t,JSON.stringify(l))},"updateComplaintStatus",0,l])},94179,e=>{"use strict";var t=e.i(43476),r=e.i(47163);function s({className:e,variant:s="default",...a}){return(0,t.jsx)("div",{className:(0,r.cn)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-slate-950 focus:ring-offset-2",{default:"border-transparent bg-blue-600 text-white hover:bg-blue-600/80",secondary:"border-transparent bg-slate-100 text-slate-900 hover:bg-slate-100/80",destructive:"border-transparent bg-red-500 text-white hover:bg-red-500/80",outline:"text-slate-950",success:"border-transparent bg-green-500 text-white",warning:"border-transparent bg-amber-500 text-white"}[s],e),...a})}e.s(["Badge",()=>s])},63209,e=>{"use strict";let t=(0,e.i(75254).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},87413,78894,e=>{"use strict";var t=e.i(43476),r=e.i(94179),s=e.i(75254);let a=(0,s.default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>a],78894);var l=e.i(63209);let i=(0,s.default)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);function o({priority:e,size:s="default"}){if(!e)return null;let o="bg-slate-100 text-slate-700",n=(0,t.jsx)(i,{className:"h-3 w-3 mr-1"});switch(e){case"Emergency":o="bg-red-100 text-red-700 border-red-200 animate-pulse-slow",n=(0,t.jsx)(a,{className:"h-3 w-3 mr-1"});break;case"Moderate":o="bg-yellow-100 text-yellow-800 border-yellow-200",n=(0,t.jsx)(l.AlertCircle,{className:"h-3 w-3 mr-1"});break;case"Casual":o="bg-green-100 text-green-700 border-green-200",n=(0,t.jsx)(i,{className:"h-3 w-3 mr-1"})}return(0,t.jsxs)(r.Badge,{variant:"outline",className:`${o} ${"sm"===s?"px-1.5 py-0.5 text-[10px]":"px-2.5 py-0.5 text-xs"} font-medium border`,children:[n,e]})}e.s(["default",()=>o],87413)},95468,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],95468)},16948,e=>{"use strict";let t="janseva_workers",r=()=>{let e=localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(e){console.error("Failed to parse workers",e)}return[]};e.s(["getWorkers",0,r,"registerWorker",0,(e,s)=>{let a=r();if(a.some(e=>e.email===s))return;let l={id:s,name:e,email:s,role:"worker",registeredAt:new Date().toISOString(),status:"Active",avatar:`https://api.dicebear.com/7.x/avataaars/svg?seed=${s}`};a.push(l),localStorage.setItem(t,JSON.stringify(a))}])},62196,e=>{"use strict";var t=e.i(43476),r=e.i(18566),s=e.i(71645),a=e.i(69259),l=e.i(16948),i=e.i(70065),o=e.i(67881),n=e.i(94179),d=e.i(23750),c=e.i(10708),m=e.i(71689),u=e.i(84614),h=e.i(46897),p=e.i(95468);let g=(0,e.i(75254).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var x=e.i(67509),f=e.i(68553),b=e.i(87413),k=e.i(22016);function y(){let{id:e}=(0,r.useParams)(),y=(0,r.useRouter)(),[w,v]=(0,s.useState)(null),[j,N]=(0,s.useState)([]),[C,S]=(0,s.useState)(""),[I,A]=(0,s.useState)(""),[P,R]=(0,s.useState)(!1),[T,D]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let t=(0,a.getComplaintById)(e);t&&(v(t),t.workDeadline&&A(t.workDeadline.split("T")[0]),t.workerId&&S(t.workerId)),N((0,l.getWorkers)())},[e]);let M=async()=>{if(!C||!I)return;R(!0);let t=j.find(e=>e.id===C);await (0,a.updateComplaintStatus)(e,"In Progress",{workerId:C,workerName:t?.name,workDeadline:new Date(I).toISOString()}),D(!0),setTimeout(()=>y.push("/dashboard/authority"),1500)},O=async t=>{R(!0),t?await (0,a.updateComplaintStatus)(e,"Resolved",{verificationStatus:"Verified",resolvedAt:new Date().toISOString()}):await (0,a.updateComplaintStatus)(e,"In Progress",{verificationStatus:"Rejected",statusRemarks:"Work rejected by officer. Please redo with correct evidence."}),D(!0),setTimeout(()=>y.push("/dashboard/authority"),1500)};if(!w)return(0,t.jsx)("div",{className:"p-10 text-center",children:"Loading grievance details..."});let L="Submitted"===w.status,W="Work Completed"===w.status;return(0,t.jsxs)("div",{className:"min-h-screen bg-slate-50 pb-20 p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(k.default,{href:"/dashboard/authority",children:(0,t.jsx)(o.Button,{variant:"ghost",size:"icon",className:"-ml-2",children:(0,t.jsx)(m.ArrowLeft,{className:"h-5 w-5"})})}),(0,t.jsx)("h1",{className:"text-xl font-bold text-slate-900 tracking-tight",children:"Resolve Grievance"})]}),T&&(0,t.jsxs)("div",{className:"bg-green-100 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center gap-2 animate-in fade-in slide-in-from-top-4",children:[(0,t.jsx)(p.CheckCircle2,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Action successful! Redirecting..."})]}),(0,t.jsxs)(i.Card,{className:"border-slate-200",children:[(0,t.jsxs)(i.CardHeader,{className:"pb-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsx)(n.Badge,{variant:"outline",className:"text-blue-600 bg-blue-50 border-blue-100 capitalize",children:w.category}),(0,t.jsx)(b.default,{priority:w.priorityType})]}),(0,t.jsx)(i.CardTitle,{className:"text-lg",children:w.title}),(0,t.jsx)(i.CardDescription,{className:"text-slate-600 leading-relaxed mt-2",children:w.description})]}),(0,t.jsxs)(i.CardContent,{className:"space-y-4 pt-0 border-t border-slate-50 mt-2",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[(0,t.jsx)(h.MapPin,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{children:w.location||"Location Not Specified"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[(0,t.jsx)(u.User,{className:"h-3.5 w-3.5"}),(0,t.jsxs)("span",{children:["ID: ",w.id]})]})]}),w.image&&(0,t.jsx)("div",{className:"rounded-lg overflow-hidden border border-slate-200 mt-2",children:(0,t.jsx)("img",{src:w.image,alt:"Evidence",className:"w-full h-48 object-cover"})})]})]}),L&&(0,t.jsxs)(i.Card,{className:"border-blue-200 shadow-md",children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsxs)(i.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,t.jsx)(x.HardHat,{className:"h-5 w-5 text-blue-600"}),"Assign Field Worker"]})}),(0,t.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"worker",children:"Select Worker"}),(0,t.jsxs)("select",{id:"worker",className:"w-full p-2 rounded-md border border-slate-200 bg-white text-sm focus:ring-2 focus:ring-blue-500",value:C,onChange:e=>S(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Select a worker..."}),j.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.email,")"]},e.id))]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"deadline",children:"Set Resolution Deadline"}),(0,t.jsx)(d.Input,{id:"deadline",type:"date",value:I,onChange:e=>A(e.target.value)})]}),(0,t.jsx)(o.Button,{className:"w-full bg-blue-600 hover:bg-blue-700 font-semibold",disabled:!C||!I||P,onClick:M,children:P?"Assigning...":"Assign Task"})]})]}),W&&(0,t.jsxs)(i.Card,{className:"border-purple-200 shadow-md",children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsxs)(i.CardTitle,{className:"text-base flex items-center gap-2 text-purple-700",children:[(0,t.jsx)(p.CheckCircle2,{className:"h-5 w-5"}),"Verify Resolution"]})}),(0,t.jsxs)(i.CardContent,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"text-sm font-medium flex items-center gap-2",children:[(0,t.jsx)(f.Camera,{className:"h-4 w-4 text-slate-500"}),"Worker Submission Proof"]}),w.workerProofImage?(0,t.jsx)("img",{src:w.workerProofImage,alt:"Completion Proof",className:"w-full rounded-lg border border-slate-200"}):(0,t.jsx)("div",{className:"p-10 bg-slate-100 rounded-lg text-center text-slate-500 text-xs",children:"No completion photo provided"}),w.workerRemarks&&(0,t.jsxs)("div",{className:"p-3 bg-slate-50 rounded text-xs text-slate-600 italic border-l-4 border-slate-300",children:['Worker Insight: "',w.workerRemarks,'"']})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsxs)(o.Button,{variant:"outline",className:"flex-1 border-red-200 text-red-600 hover:bg-red-50",disabled:P,onClick:()=>O(!1),children:[(0,t.jsx)(g,{className:"mr-2 h-4 w-4"})," Reject Work"]}),(0,t.jsxs)(o.Button,{className:"flex-1 bg-green-600 hover:bg-green-700",disabled:P,onClick:()=>O(!0),children:[(0,t.jsx)(p.CheckCircle2,{className:"mr-2 h-4 w-4"})," Approve & Close"]})]})]})]}),!L&&!W&&(0,t.jsx)(i.Card,{className:"bg-slate-100/50 border-0",children:(0,t.jsx)(i.CardContent,{className:"p-4 text-center",children:(0,t.jsxs)("p",{className:"text-sm text-slate-500",children:["This grievance is currently ",(0,t.jsx)("strong",{children:w.status}),".",w.workerName&&` Assigned to ${w.workerName}.`]})})})]})}e.s(["default",()=>y],62196)},4021,e=>{e.v(t=>Promise.all(["static/chunks/9f60f9bd9e2ddc15.js"].map(t=>e.l(t))).then(()=>t(9572)))}]);