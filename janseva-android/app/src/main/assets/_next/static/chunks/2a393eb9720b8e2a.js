(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,94179,e=>{"use strict";var t=e.i(43476),a=e.i(47163);function s({className:e,variant:s="default",...r}){return(0,t.jsx)("div",{className:(0,a.cn)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-slate-950 focus:ring-offset-2",{default:"border-transparent bg-blue-600 text-white hover:bg-blue-600/80",secondary:"border-transparent bg-slate-100 text-slate-900 hover:bg-slate-100/80",destructive:"border-transparent bg-red-500 text-white hover:bg-red-500/80",outline:"text-slate-950",success:"border-transparent bg-green-500 text-white",warning:"border-transparent bg-amber-500 text-white"}[s],e),...r})}e.s(["Badge",()=>s])},63209,e=>{"use strict";let t=(0,e.i(75254).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},87413,78894,e=>{"use strict";var t=e.i(43476),a=e.i(94179),s=e.i(75254);let r=(0,s.default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>r],78894);var l=e.i(63209);let i=(0,s.default)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);function o({priority:e,size:s="default"}){if(!e)return null;let o="bg-slate-100 text-slate-700",n=(0,t.jsx)(i,{className:"h-3 w-3 mr-1"});switch(e){case"Emergency":o="bg-red-100 text-red-700 border-red-200 animate-pulse-slow",n=(0,t.jsx)(r,{className:"h-3 w-3 mr-1"});break;case"Moderate":o="bg-yellow-100 text-yellow-800 border-yellow-200",n=(0,t.jsx)(l.AlertCircle,{className:"h-3 w-3 mr-1"});break;case"Casual":o="bg-green-100 text-green-700 border-green-200",n=(0,t.jsx)(i,{className:"h-3 w-3 mr-1"})}return(0,t.jsxs)(a.Badge,{variant:"outline",className:`${o} ${"sm"===s?"px-1.5 py-0.5 text-[10px]":"px-2.5 py-0.5 text-xs"} font-medium border`,children:[n,e]})}e.s(["default",()=>o],87413)},71689,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},3116,e=>{"use strict";let t=(0,e.i(75254).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Clock",()=>t],3116)},95468,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],95468)},69259,e=>{"use strict";let t="janseva_complaints",a=(e,t,a)=>{let s=`${e} ${t} ${a}`.toLowerCase();return["accident","fire","gas leak","flood","fallen tree","electric shock","sewage overflow","road collapse","water pipeline burst","burst","collapse","danger","hazard","chemical spill","factory fire","industrial gas leak","explosion","safety risk","unsafe","gas leak"].some(e=>s.includes(e))?"Emergency":["street light","garbage","drainage","water leakage","pothole","traffic signal","leak","blocked","pollution","waste","fumes","banking","ticket","staff"].some(e=>s.includes(e))?"Moderate":"Casual"},s=e=>{let t=10;return e.image&&(t+=5),"Emergency"===e.priorityType&&(t+=10),"Moderate"===e.priorityType&&(t+=5),t},r=()=>{let e=localStorage.getItem(t);if(!e)return[];try{return JSON.parse(e)}catch(e){return console.error("Failed to parse complaints",e),[]}},l=async(a,s,l)=>{let{sendNotification:o}=await e.A(4021),n=r(),c=n.findIndex(e=>e.id===a);if(-1!==c){var d,m,u,h;let e,r,x,p=n[c];"Work Completed"===s&&l?.workerProofLocation&&(d=p.lat,m=p.lng,u=l.workerProofLocation.lat,h=l.workerProofLocation.lng,e=i(u-d),r=i(h-m),6371*(2*Math.atan2(Math.sqrt(x=Math.sin(e/2)*Math.sin(e/2)+Math.cos(i(d))*Math.cos(i(u))*Math.sin(r/2)*Math.sin(r/2)),Math.sqrt(1-x)))>.5)&&(l.workerRemarks=(l.workerRemarks||"")+" [FLAG: Location mismatch detected]");let g={...p,status:s,...l};n[c]=g;let f={status:s,date:new Date().toISOString(),completed:!0};n[c].timeline.push(f),localStorage.setItem(t,JSON.stringify(n)),"Resolved"===s?o("user",`Good news! Your complaint #${a} has been marked as RESOLVED.`,"success",a):"In Progress"===s?(o("user",`Work has started on your complaint #${a}.`,"info",a),g.workerId&&o("worker",`New task assigned: Complaint #${a}. Please check details.`,"info",a)):"Work Completed"===s?o("authority",`Work completed for #${a}. Waiting for verification.`,"success",a):"Delayed"===s&&o("admin",`SLA Breach: Complaint #${a} is currently DELAYED.`,"error",a)}};function i(e){return Math.PI/180*e}let o=async()=>{let a=r(),s=!1,l=new Date,{sendNotification:i}=await e.A(4021);a.forEach(e=>{e.workDeadline&&!["Work Completed","Resolved","Rejected"].includes(e.status)&&!e.isOverdue&&l>new Date(e.workDeadline)&&(e.isOverdue=!0,e.alertSentAt=l.toISOString(),("In Progress"===e.status||"Submitted"===e.status)&&(e.status="Delayed",e.timeline.push({status:"Delayed",date:l.toISOString(),completed:!0})),s=!0,e.workerId&&i("worker",`URGENT: Task #${e.id} is Overdue! Please complete immediately.`,"error",e.id),i("authority",`Alert: Task #${e.id} has breached deadline. Worker: ${e.workerId||"Unassigned"}`,"warning",e.id))}),s&&localStorage.setItem(t,JSON.stringify(a))};e.s(["calculateCreditPoints",0,s,"checkOverdueComplaints",0,o,"determinePriority",0,a,"getComplaintById",0,e=>r().find(t=>t.id===e),"getComplaints",0,r,"saveComplaint",0,e=>{e.priorityType||(e.priorityType=a(e.title,e.description,e.category)),e.creditPoints=s(e);let l=r();l.unshift(e),localStorage.setItem(t,JSON.stringify(l))},"updateComplaintStatus",0,l])},84762,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(47163);let r=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-slate-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...a}));r.displayName="Textarea",e.s(["Textarea",()=>r])},10708,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(47163);let r=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("label",{ref:r,className:(0,s.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-slate-700",e),...a}));r.displayName="Label",e.s(["Label",()=>r])},68553,e=>{"use strict";let t=(0,e.i(75254).default)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);e.s(["Camera",()=>t],68553)},83954,e=>{"use strict";var t=e.i(43476),a=e.i(18566),s=e.i(71645),r=e.i(69259),l=e.i(70065),i=e.i(67881),o=e.i(94179),n=e.i(10708),c=e.i(84762),d=e.i(71689),m=e.i(3116),u=e.i(46897),h=e.i(68553),x=e.i(95468);let p=(0,e.i(75254).default)("navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);var g=e.i(78894),f=e.i(87413),b=e.i(22016);function y(){let{id:e}=(0,a.useParams)(),y=(0,a.useRouter)(),[k,w]=(0,s.useState)(null),[j,v]=(0,s.useState)(!1),[N,C]=(0,s.useState)(!1),[S,P]=(0,s.useState)(""),[M,T]=(0,s.useState)(null);(0,s.useEffect)(()=>{let t=(0,r.getComplaintById)(e);t&&w(t)},[e]);let I=async()=>{v(!0),await (0,r.updateComplaintStatus)(e,"In Progress"),w({...k,status:"In Progress"}),v(!1)},A=async()=>{if(!M)return void alert("Please provide photo evidence of the completed work.");v(!0);let t={lat:k.lat+1e-4*Math.random(),lng:k.lng+1e-4*Math.random()};await (0,r.updateComplaintStatus)(e,"Work Completed",{workerProofImage:M,workerRemarks:S,workerProofLocation:t,completedAt:new Date().toISOString()}),C(!0),setTimeout(()=>y.push("/dashboard/worker"),1500)};if(!k)return(0,t.jsx)("div",{className:"p-10 text-center text-slate-500",children:"Loading work order..."});let L="Submitted"===k.status,R="In Progress"===k.status,O="Work Completed"===k.status||"Resolved"===k.status;return(0,t.jsxs)("div",{className:"min-h-screen bg-slate-50 pb-20 p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(b.default,{href:"/dashboard/worker",children:(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",className:"-ml-2",children:(0,t.jsx)(d.ArrowLeft,{className:"h-5 w-5"})})}),(0,t.jsx)("h1",{className:"text-xl font-bold text-slate-900 tracking-tight",children:"Work Details"})]}),N&&(0,t.jsxs)("div",{className:"bg-green-100 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center gap-2 animate-in fade-in slide-in-from-top-4",children:[(0,t.jsx)(x.CheckCircle2,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Work reported successfully!"})]}),(0,t.jsxs)(l.Card,{className:"border-slate-200",children:[(0,t.jsxs)(l.CardHeader,{className:"pb-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsx)(o.Badge,{variant:"outline",className:"text-blue-600 bg-blue-50 border-blue-100",children:k.category}),(0,t.jsx)(f.default,{priority:k.priorityType})]}),(0,t.jsx)(l.CardTitle,{className:"text-lg",children:k.title}),(0,t.jsx)(l.CardDescription,{children:k.description})]}),(0,t.jsxs)(l.CardContent,{className:"space-y-4 pt-0 border-t border-slate-50 mt-2",children:[(0,t.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-100 flex items-start gap-2 mt-4",children:[(0,t.jsx)(u.MapPin,{className:"h-4 w-4 text-blue-600 mt-0.5"}),(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsx)("p",{className:"font-semibold text-blue-700",children:"Service Location"}),(0,t.jsx)("p",{className:"text-blue-600/80",children:k.location||"See Map for specific GPS coordinates"})]})]}),k.image&&(0,t.jsxs)("div",{className:"rounded-lg overflow-hidden border border-slate-200 mt-2",children:[(0,t.jsx)("p",{className:"text-[10px] uppercase font-bold text-slate-400 p-2 bg-slate-50",children:"Problem Photo"}),(0,t.jsx)("img",{src:k.image,alt:"Original Issue",className:"w-full h-40 object-cover"})]})]})]}),L&&(0,t.jsx)(l.Card,{className:"border-orange-200 shadow-md",children:(0,t.jsxs)(l.CardContent,{className:"p-6",children:[(0,t.jsxs)("p",{className:"text-sm text-slate-600 mb-4 flex items-center gap-2",children:[(0,t.jsx)(m.Clock,{className:"h-4 w-4 text-orange-500"}),"This task hasn't been started yet."]}),(0,t.jsx)(i.Button,{className:"w-full bg-orange-600 hover:bg-orange-700 font-semibold",onClick:I,disabled:j,children:j?"Starting...":"Mark as Started"})]})}),R&&(0,t.jsxs)(l.Card,{className:"border-blue-200 shadow-md",children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)(l.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,t.jsx)(x.CheckCircle2,{className:"h-5 w-5 text-blue-600"}),"Finish Work"]})}),(0,t.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Completion Proof (After Photo)"}),(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center border-2 border-dashed border-slate-200 rounded-lg p-6 hover:bg-slate-50 transition-colors relative cursor-pointer group",children:[(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onloadend=()=>{T(e.result)},e.readAsDataURL(t)}},className:"absolute inset-0 opacity-0 cursor-pointer"}),M?(0,t.jsx)("img",{src:M,alt:"Preview",className:"w-full h-40 object-cover rounded-md"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Camera,{className:"h-8 w-8 text-slate-400 group-hover:text-blue-500 mb-2"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Tap to snap resolution photo"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Completion Remarks"}),(0,t.jsx)(c.Textarea,{placeholder:"Describe the work done...",value:S,onChange:e=>P(e.target.value),className:"text-sm"})]}),(0,t.jsxs)("div",{className:"bg-amber-50 p-2 rounded text-[10px] text-amber-700 flex items-center gap-2",children:[(0,t.jsx)(g.AlertTriangle,{className:"h-3 w-3"}),(0,t.jsx)("span",{children:"Your current GPS location will be attached as proof."})]}),(0,t.jsx)(i.Button,{className:"w-full bg-blue-600 hover:bg-blue-700 font-semibold",onClick:A,disabled:j,children:j?"Submitting...":"Submit Completion Report"})]})]}),O&&(0,t.jsx)(l.Card,{className:"bg-green-50 border-green-100",children:(0,t.jsxs)(l.CardContent,{className:"p-4 flex flex-col items-center text-center",children:[(0,t.jsx)("div",{className:"h-10 w-10 bg-green-100 rounded-full flex items-center justify-center mb-2",children:(0,t.jsx)(x.CheckCircle2,{className:"h-6 w-6 text-green-600"})}),(0,t.jsx)("h4",{className:"font-semibold text-green-800",children:"Work Submitted"}),(0,t.jsx)("p",{className:"text-xs text-green-700 mt-1",children:"This task is under verification by authorities."})]})}),!O&&(0,t.jsxs)(i.Button,{variant:"outline",className:"w-full border-slate-300",children:[(0,t.jsx)(p,{className:"mr-2 h-4 w-4"})," Open in Google Maps"]})]})}e.s(["default",()=>y],83954)},4021,e=>{e.v(t=>Promise.all(["static/chunks/9f60f9bd9e2ddc15.js"].map(t=>e.l(t))).then(()=>t(9572)))}]);