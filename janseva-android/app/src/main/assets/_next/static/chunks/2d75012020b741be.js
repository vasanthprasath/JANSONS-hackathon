(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,69259,e=>{"use strict";let t="janseva_complaints",a=(e,t,a)=>{let r=`${e} ${t} ${a}`.toLowerCase();return["accident","fire","gas leak","flood","fallen tree","electric shock","sewage overflow","road collapse","water pipeline burst","burst","collapse","danger","hazard","chemical spill","factory fire","industrial gas leak","explosion","safety risk","unsafe","gas leak"].some(e=>r.includes(e))?"Emergency":["street light","garbage","drainage","water leakage","pothole","traffic signal","leak","blocked","pollution","waste","fumes","banking","ticket","staff"].some(e=>r.includes(e))?"Moderate":"Casual"},r=e=>{let t=10;return e.image&&(t+=5),"Emergency"===e.priorityType&&(t+=10),"Moderate"===e.priorityType&&(t+=5),t},o=()=>{let e=localStorage.getItem(t);if(!e)return[];try{return JSON.parse(e)}catch(e){return console.error("Failed to parse complaints",e),[]}},i=async(a,r,i)=>{let{sendNotification:l}=await e.A(4021),n=o(),c=n.findIndex(e=>e.id===a);if(-1!==c){var d,u,m,p;let e,o,g,k=n[c];"Work Completed"===r&&i?.workerProofLocation&&(d=k.lat,u=k.lng,m=i.workerProofLocation.lat,p=i.workerProofLocation.lng,e=s(m-d),o=s(p-u),6371*(2*Math.atan2(Math.sqrt(g=Math.sin(e/2)*Math.sin(e/2)+Math.cos(s(d))*Math.cos(s(m))*Math.sin(o/2)*Math.sin(o/2)),Math.sqrt(1-g)))>.5)&&(i.workerRemarks=(i.workerRemarks||"")+" [FLAG: Location mismatch detected]");let h={...k,status:r,...i};n[c]=h;let f={status:r,date:new Date().toISOString(),completed:!0};n[c].timeline.push(f),localStorage.setItem(t,JSON.stringify(n)),"Resolved"===r?l("user",`Good news! Your complaint #${a} has been marked as RESOLVED.`,"success",a):"In Progress"===r?(l("user",`Work has started on your complaint #${a}.`,"info",a),h.workerId&&l("worker",`New task assigned: Complaint #${a}. Please check details.`,"info",a)):"Work Completed"===r?l("authority",`Work completed for #${a}. Waiting for verification.`,"success",a):"Delayed"===r&&l("admin",`SLA Breach: Complaint #${a} is currently DELAYED.`,"error",a)}};function s(e){return Math.PI/180*e}let l=async()=>{let a=o(),r=!1,i=new Date,{sendNotification:s}=await e.A(4021);a.forEach(e=>{e.workDeadline&&!["Work Completed","Resolved","Rejected"].includes(e.status)&&!e.isOverdue&&i>new Date(e.workDeadline)&&(e.isOverdue=!0,e.alertSentAt=i.toISOString(),("In Progress"===e.status||"Submitted"===e.status)&&(e.status="Delayed",e.timeline.push({status:"Delayed",date:i.toISOString(),completed:!0})),r=!0,e.workerId&&s("worker",`URGENT: Task #${e.id} is Overdue! Please complete immediately.`,"error",e.id),s("authority",`Alert: Task #${e.id} has breached deadline. Worker: ${e.workerId||"Unassigned"}`,"warning",e.id))}),r&&localStorage.setItem(t,JSON.stringify(a))};e.s(["calculateCreditPoints",0,r,"checkOverdueComplaints",0,l,"determinePriority",0,a,"getComplaintById",0,e=>o().find(t=>t.id===e),"getComplaints",0,o,"saveComplaint",0,e=>{e.priorityType||(e.priorityType=a(e.title,e.description,e.category)),e.creditPoints=r(e);let i=o();i.unshift(e),localStorage.setItem(t,JSON.stringify(i))},"updateComplaintStatus",0,i])},4021,e=>{e.v(t=>Promise.all(["static/chunks/9f60f9bd9e2ddc15.js"].map(t=>e.l(t))).then(()=>t(9572)))}]);